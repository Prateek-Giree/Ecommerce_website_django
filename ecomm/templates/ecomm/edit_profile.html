{% extends "base.html" %} {% block title %} FastCart {% endblock title %} 
{% block body %} {% load static %}

<section class="breadcrumb">
  <a href="{% url 'index' %}"><i class="fa fa-house"></i> Home</a>
  &nbsp;&nbsp;>&nbsp;&nbsp;
  <a href="{% url 'profile' request.user.id %}"
    ><i class="fa-solid fa-user"></i> My Account</a
  >
  &nbsp;&nbsp;>&nbsp;&nbsp;
  <a href=""><i class="fa-solid fa-pen"></i> Edit Profile</a>
</section>

<div class="edit-main">
  {% include "profile_sidebar.html" %}
  <div class="edit-container">
    <div class="page-header">
      <h1>Edit Profile</h1>
      <p>Update your personal information and account settings</p>
    </div>

   <form enctype="multipart/form-data" id="personalDetailsForm" method="POST" action="{% url 'edit_profile' %}" onsubmit="return validateEditForm()">
  {% csrf_token %}
  <div class="form-section">
    <h2 class="section-title">Edit Personal Details</h2>

    <div class="form-info">
      <strong>ðŸ’¡ Tip:</strong> Keep your information up to date to ensure smooth delivery and communication.
    </div>

    <div class="form-grid">
      <!-- Full Name -->
      <div class="form-group">
        <label for="fullName">Full Name <span class="required">*</span></label>
        <input
          type="text"
          id="fullName"
          name="fullName"
          value="{{ user.first_name }}"
          onblur="nameValidation('fullName', 'nameErr')"
          required
        />
        <span class="error" id="nameErr"></span>
      </div>

      <!-- Email -->
      <div class="form-group">
        <label for="email">Email Address <span class="required">*</span></label>
        <input
          type="email"
          id="email"
          name="email"
          value="{{ user.email }}"
          onblur="emailValidation('email', 'emailErr')"
          required
        />
        <span class="error" id="emailErr"></span>
      </div>

      <!-- Phone -->
      <div class="form-group">
        <label for="phone">Phone Number <span class="required">*</span></label>
        <input
          type="tel"
          id="phone"
          name="phone"
          value="{{ user_profile.phone }}"
          onblur="contactValidation('phone', 'phoneErr')"
          required
        />
        <span class="error" id="phoneErr"></span>
      </div>

      <!-- Delivery Address -->
      <div class="form-group">
        <label for="deliveryAddress">Default Delivery Address</label>
        <select id="deliveryAddress" name="delivery_addr">
          <option value="{{ delivery_address.id }}">{{ delivery_address }}</option>
          {% for address in delivery_addresses %}
          <option value="{{ address.id }}">{{ address.location }}</option>
          {% endfor %}
        </select>
        <span class="error"></span>
      </div>

      <!-- Primary Address -->
      <div class="form-group full-width">
        <label for="address">Primary Address <span class="required">*</span></label>
        <textarea id="address" name="address" onblur="addressValidation('address', 'addressErr')" required>{{ user_profile.address }}</textarea>
        <span class="error" id="addressErr"></span>
      </div>
    </div>

    <!-- Profile Image -->
    <div class="form-group">
      <label for="profileImage">Profile Image</label>
      {% if user_profile.profile_image %}
      <div style="margin-bottom: 10px">
        <img src="{{ user_profile.profile_image.url }}" alt="Current Image" style="height: 80px; border-radius: 8px" />
      </div>
      {% endif %}
      <input type="file" id="profileImage" name="profile_image" accept="image/*" />
      <span class="error"></span>
    </div>

    <!-- Action Buttons -->
    <div class="btn-group">
      <a onclick="return confirm('Are you sure want to cancel?')" href="{% url 'profile' request.user.id %}" class="btn btn-secondary">Cancel</a>
      <button type="submit" name="update_details" class="btn btn-primary">Update Personal Details</button>
    </div>
  </div>
</form>


    <!-- Change Password Form -->
  <form id="passwordForm" method="POST" action="{% url 'edit_profile' %}" onsubmit="return validatePasswordForm()">
  {% csrf_token %}
  <div class="form-section">
    <h2 class="section-title">Change Password</h2>

    <div class="form-info">
      <strong>ðŸ”’ Security:</strong> Choose a strong password with at least 8
      characters, including uppercase, lowercase, numbers, and special
      characters.
    </div>

    <div class="form-grid">
      <!-- Current Password -->
      <div class="form-group">
        <label for="currentPassword">Current Password <span class="required">*</span></label>
        <div class="input-group">
          <input type="password" id="currentPassword" name="currentPassword" required />
          <span class="input-icon" onclick="togglePassword('currentPassword')">
            <i class="fa-solid fa-eye"></i>
          </span>
        </div>
        <span class="error" id="currentPassErr"></span>
      </div>

      <!-- New Password -->
      <div class="form-group">
        <label for="newPassword">New Password <span class="required">*</span></label>
        <div class="input-group">
          <input
            type="password"
            id="newPassword"
            name="newPassword"
            onblur="passwordValidation('newPassword', 'newPassErr')"
            required
          />
          <span class="input-icon" onclick="togglePassword('newPassword')">
            <i class="fa-solid fa-eye"></i>
          </span>
        </div>
        <span class="error" id="newPassErr"></span>
        <div class="password-strength" id="passwordStrength">
          <div class="strength-bar">
            <div class="strength-fill"></div>
          </div>
          <span class="strength-text">Password strength: Not entered</span>
        </div>
        <div class="password-help">
          Password must be at least 8 characters long and contain uppercase, lowercase, numbers, and special characters.
        </div>
      </div>

      <!-- Confirm Password -->
      <div class="form-group">
        <label for="confirmPassword">Confirm New Password <span class="required">*</span></label>
        <div class="input-group">
          <input
            type="password"
            id="confirmPassword"
            name="confirmPassword"
            onblur="confirmPasswordValidation('newPassword', 'confirmPassword', 'confirmPassErr')"
            required
          />
          <span class="input-icon" onclick="togglePassword('confirmPassword')">
            <i class="fa-solid fa-eye"></i>
          </span>
        </div>
        <span class="error" id="confirmPassErr"></span>
        <div id="passwordMatch" class="password-help"></div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="btn-group">
      <a
        onclick="return confirm('Are you sure want to cancel?')"
        href="{% url 'profile' request.user.id %}"
        type="button"
        class="btn btn-secondary"
      >
        Cancel
      </a>
      <button type="submit" name="change_password" class="btn btn-primary">
        Change Password
      </button>
    </div>
  </div>
</form>

  </div>
</div>
{% endblock body %}
