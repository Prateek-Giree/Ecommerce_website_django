{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{% static "css/pass_reset.css" %}">
    <title>Reset Password</title>
  </head>
  <body>
    <div class="reset-password-container">
      <div class="floating-shapes"></div>

      <div class="logo-section">
        <div class="logo">FastCart</div>
      </div>

      <div class="lock-icon">
        <svg viewBox="0 0 24 24">
          <path
            d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"
          />
        </svg>
      </div>

      <h1 class="page-title">Reset Your Password</h1>
      <p class="page-description">
        Create a new secure password for your FastCart account. Make sure it's
        strong and unique.
      </p>

      <div class="success-message" id="successMessage">
        Password has been reset successfully! Redirecting to login...
      </div>

      <div class="error-message" id="errorMessage">
        Please check the requirements and try again.
      </div>

      <form method="POST" class="reset-form" id="resetForm">
        {% csrf_token %}
        <div class="form-group">
          <label for="password" class="form-label">New Password</label>
          <div class="password-input-container">
            <input
              type="password"
              id="password"
              name="password"
              class="password-input"
              placeholder="Enter your new password"
              required
              minlength="8"
            />
            <button
              type="button"
              class="toggle-password"
              data-target="password"
            >
              <svg viewBox="0 0 24 24" class="eye-open">
                <path
                  d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"
                />
              </svg>
              <svg viewBox="0 0 24 24" class="eye-closed" style="display: none">
                <path
                  d="M11.83,9L15,12.16C15,12.11 15,12.05 15,12A3,3 0 0,0 12,9C11.94,9 11.89,9 11.83,9M7.53,9.8L9.08,11.35C9.03,11.56 9,11.77 9,12A3,3 0 0,0 12,15C12.22,15 12.44,14.97 12.65,14.92L14.2,16.47C13.53,16.8 12.79,17 12,17A5,5 0 0,1 7,12C7,11.21 7.2,10.47 7.53,9.8M2,4.27L4.28,6.55L4.73,7C3.08,8.3 1.78,10 1,12C2.73,16.39 7,19.5 12,19.5C13.55,19.5 15.03,19.2 16.38,18.66L16.81,19.09L19.73,22L21,20.73L3.27,3M12,7A5,5 0 0,1 17,12C17,12.64 16.87,13.26 16.64,13.82L19.57,16.75C21.07,15.5 22.27,13.86 23,12C21.27,7.61 17,4.5 12,4.5C10.6,4.5 9.26,4.75 8,5.2L10.17,7.35C10.76,7.13 11.37,7 12,7Z"
                />
              </svg>
            </button>
          </div>
          <div class="password-strength" id="passwordStrength"></div>
        </div>

        <div class="form-group">
          <label for="confirmPassword" class="form-label"
            >Confirm New Password</label
          >
          <div class="password-input-container">
            <input
              type="password"
              id="confirmPassword"
              name="confirm_password"
              class="password-input"
              placeholder="Confirm your new password"
              required
            />
            <button
              type="button"
              class="toggle-password"
              data-target="confirmPassword"
            >
              <svg viewBox="0 0 24 24" class="eye-open">
                <path
                  d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"
                />
              </svg>
              <svg viewBox="0 0 24 24" class="eye-closed" style="display: none">
                <path
                  d="M11.83,9L15,12.16C15,12.11 15,12.05 15,12A3,3 0 0,0 12,9C11.94,9 11.89,9 11.83,9M7.53,9.8L9.08,11.35C9.03,11.56 9,11.77 9,12A3,3 0 0,0 12,15C12.22,15 12.44,14.97 12.65,14.92L14.2,16.47C13.53,16.8 12.79,17 12,17A5,5 0 0,1 7,12C7,11.21 7.2,10.47 7.53,9.8M2,4.27L4.28,6.55L4.73,7C3.08,8.3 1.78,10 1,12C2.73,16.39 7,19.5 12,19.5C13.55,19.5 15.03,19.2 16.38,18.66L16.81,19.09L19.73,22L21,20.73L3.27,3M12,7A5,5 0 0,1 17,12C17,12.64 16.87,13.26 16.64,13.82L19.57,16.75C21.07,15.5 22.27,13.86 23,12C21.27,7.61 17,4.5 12,4.5C10.6,4.5 9.26,4.75 8,5.2L10.17,7.35C10.76,7.13 11.37,7 12,7Z"
                />
              </svg>
            </button>
          </div>
          <div class="password-match" id="passwordMatch"></div>
        </div>

        <button type="submit" class="reset-button" id="submitBtn">
          Reset Password
        </button>
      </form>

      <div class="additional-info">
        <a href="#" class="back-link">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"
            />
          </svg>
          Back to Login
        </a>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const passwordInput = document.getElementById("password");
        const confirmPasswordInput = document.getElementById("confirmPassword");

        passwordInput.focus();

        document.querySelectorAll(".toggle-password").forEach((button) => {
          button.addEventListener("click", function () {
            const targetId = this.getAttribute("data-target");
            const targetInput = document.getElementById(targetId);
            const eyeOpen = this.querySelector(".eye-open");
            const eyeClosed = this.querySelector(".eye-closed");

            if (targetInput.type === "password") {
              targetInput.type = "text";
              eyeOpen.style.display = "none";
              eyeClosed.style.display = "block";
            } else {
              targetInput.type = "password";
              eyeOpen.style.display = "block";
              eyeClosed.style.display = "none";
            }
          });
        });

        // Password strength check
        passwordInput.addEventListener("input", function () {
          const password = this.value;
          const strengthIndicator = document.getElementById("passwordStrength");

          if (password.length === 0) {
            strengthIndicator.style.display = "none";
            return;
          }

          const strength = getPasswordStrength(password);
          strengthIndicator.style.display = "block";
          strengthIndicator.className = "password-strength " + strength.class;
          strengthIndicator.textContent = strength.text;

          checkPasswordMatch();
        });

        // Password match check
        confirmPasswordInput.addEventListener("input", checkPasswordMatch);
      });

      // Function to determine password strength
      function getPasswordStrength(password) {
        let score = 0;
        const checks = {
          length: password.length >= 8,
          lowercase: /[a-z]/.test(password),
          uppercase: /[A-Z]/.test(password),
          numbers: /\d/.test(password),
          special: /[^A-Za-z0-9]/.test(password),
        };

        score = Object.values(checks).filter(Boolean).length;

        if (score < 3) {
          return {
            score,
            class: "strength-weak",
            text: "Weak - Add uppercase, numbers, and special characters",
          };
        } else if (score < 4) {
          return {
            score,
            class: "strength-medium",
            text: "Medium - Consider adding more character types",
          };
        } else {
          return {
            score,
            class: "strength-strong",
            text: "Strong - Great password!",
          };
        }
      }

      // Function to check if passwords match
      function checkPasswordMatch() {
        const password = document.getElementById("password").value;
        const confirmPassword =
          document.getElementById("confirmPassword").value;
        const matchIndicator = document.getElementById("passwordMatch");

        if (confirmPassword.length === 0) {
          matchIndicator.style.display = "none";
          return;
        }

        matchIndicator.style.display = "block";
        if (password === confirmPassword) {
          matchIndicator.className = "password-match match-success";
          matchIndicator.textContent = "Passwords match!";
        } else {
          matchIndicator.className = "password-match match-error";
          matchIndicator.textContent = "Passwords do not match";
        }
      }
    </script>
  </body>
</html>
